<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Boiler Mapper</title>
<style>
:root{--bg:#0b0d10;--panel:#151a1f;--ink:#e9eef5;--muted:#9fb0c2;--line:#2a323c;--accent:#4aa3ff}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial}
header{padding:14px 16px;border-bottom:1px solid var(--line);background:linear-gradient(0deg,#0b0d10,#0f1216)}
h1{margin:0;font-size:18px}
main{padding:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
fieldset{border:1px solid var(--line);border-radius:8px;padding:12px}
legend{padding:0 6px;color:var(--muted)}
.row{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
select,button,textarea{border:1px solid var(--line);border-radius:6px;background:var(--panel);color:var(--ink)}
select,button{padding:8px}
textarea{width:100%;min-height:120px;padding:10px;resize:vertical}
button:hover{background:#1c232b;cursor:pointer}
.section{margin-top:18px}
.tools{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.copy{padding:8px 10px}
.note{font-size:12px;color:var(--muted)}
footer{border-top:1px solid var(--line);padding:12px 16px;color:var(--muted)}
</style>
</head>
<body>
<header><h1>Boiler Mapper</h1></header>
<main>
  <div class="grid">
    <fieldset>
      <legend>Current System (A)</legend>
      <div class="row">
        <label>Boiler</label>
        <select id="BlrA">
          <option>REGULAR</option><option>SYSTEM</option><option>COMBI</option>
          <option>BBU</option><option>WARM_AIR</option><option>ELECTRIC_WET</option>
        </select>
      </div>
      <div class="row">
        <label>Flue</label>
        <select id="FluA">
          <option>H_BALANCED</option><option>V_BALANCED</option>
          <option>PLUME_KIT</option><option>OPEN_FLUE</option>
          <option>CHIMNEY</option>
        </select>
      </div>
      <div class="row">
        <label>Cylinder</label>
        <select id="CylA">
          <option>NONE</option><option>VENTED_TANKED</option><option>UNVENTED_MAINS</option>
          <option>THERMAL_STORE</option><option>FORTIC_COMBINED</option><option>PRIMATIC</option>
        </select>
      </div>
      <div class="row">
        <label>Location</label>
        <select id="LocA">
          <option>KITCHEN</option><option>GARAGE</option><option>UTILITY</option>
          <option>AIRING_CUPBOARD</option><option>BEDROOM</option><option>LOFT</option>
          <option>OUTBUILDING</option><option>OTHER</option>
        </select>
      </div>
    </fieldset>

    <fieldset>
      <legend>Proposed System (B)</legend>
      <div class="row">
        <label>Boiler</label>
        <select id="BlrB">
          <option>REGULAR</option><option>SYSTEM</option><option>COMBI</option>
          <option>ELECTRIC_WET</option>
        </select>
      </div>
      <div class="row">
        <label>Flue</label>
        <select id="FluB">
          <option>H_BALANCED</option><option>V_BALANCED</option>
          <option>PLUME_KIT</option><option>OPEN_FLUE</option>
          <option>CHIMNEY</option>
        </select>
      </div>
      <div class="row">
        <label>Cylinder</label>
        <select id="CylB">
          <option>NONE</option><option>VENTED_TANKED</option><option>UNVENTED_MAINS</option>
          <option>THERMAL_STORE</option>
        </select>
      </div>
      <div class="row">
        <label>Location</label>
        <select id="LocB">
          <option>KITCHEN</option><option>GARAGE</option><option>UTILITY</option>
          <option>AIRING_CUPBOARD</option><option>BEDROOM</option><option>LOFT</option>
          <option>OUTBUILDING</option><option>OTHER</option>
        </select>
      </div>
    </fieldset>

    <fieldset>
      <legend>Flue Terminal Location</legend>
      <div class="row">
        <label>Terminal Wall</label>
        <select id="TermWall">
          <option>REAR</option><option>FRONT</option><option>LEFT_SIDE</option><option>RIGHT_SIDE</option>
          <option>COURTYARD</option><option>ALLEY</option><option>NEAR_BOUNDARY</option>
        </select>
      </div>
      <div class="row">
        <label>Terminal Height</label>
        <select id="TermHeight">
          <option>LOW_LT_2M</option><option>MID_2_TO_2_5M</option><option>HIGH_GT_2_5M</option>
        </select>
      </div>
      <p class="note">Balanced flues are room-sealed (concentric/twin). Terminal wall/height affects guards, plume and boundary clearances.</p>
    </fieldset>
  </div>

  <div class="tools">
    <button onclick="generate()">Generate Notes</button>
    <button onclick="copyAll()">Copy All</button>
  </div>

  <div id="sections"></div>
</main>
<footer>↘️ Output uses semicolons for easy paste; balanced flues, plume and terminal rules included.</footer>

<script>
// ---- Logic notes grouped by section
const NOTES = {
  SystemChanges: {
    remove_cylinder:"↘️ Remove existing hot-water cylinder and associated components;",
    space_gain:"↘️ Space reclaimed from cylinder/loft tanks — confirm preferred use;",
    remove_FandE:"↘️ Remove F&E tanks and convert to sealed system where applicable;",
    cylinder_relocation:"↘️ New cylinder location — allow primary/secondary runs and compliant discharge path;"
  },
  HotWater: {
    combi_performance:"↘️ Combi hot-water performance depends on mains flow; simultaneous draws reduce flow/temperature;",
    cold_main_check:"↘️ Verify incoming cold main flow/pressure meets combi/unvented requirements; upgrade if inadequate;",
    unvented_requirements:"↘️ Provide unvented G3 safety set, correctly sized discharge (D2) and termination; confirm main capacity;",
    unvented_benefit:"↘️ Unvented cylinder provides mains-pressure hot water at multiple outlets (subject to main capacity);",
    vented_characteristics:"↘️ Vented cylinder performance depends on tank head height; consider shower pump where appropriate;",
    thermal_store_specifics:"↘️ Thermal store: confirm compatibility, heat source interfaces and delivery temperatures;"
  },
  Flue: {
    flue_clearances:"↘️ Check flue type/route/terminal clearances vs MI; confirm guards and plume management if needed;",
    terminal_guard_required:"↘️ Terminal <2 m above ground or accessible — provide terminal guard as required;",
    boundary_clearance_review:"↘️ Terminal near boundary/front/alley — confirm boundary clearances and neighbour impact;",
    plume_mitigation:"↘️ Anticipated plume — consider plume kit/deflector to protect paths, windows and boundaries;",
    chimney_decommission:"↘️ Decommission/liner considerations for chimney/open flue; cap and make good as required;"
  },
  Gas: {
    gas_supply_check:"↘️ Confirm gas pipe sizing and route for new input rating; upgrade if required;"
  },
  Condensate: {
    condensate_route:"↘️ Confirm compliant condensate route and termination;"
  },
  LocationAndMakingGood: {
    loc_old_new:"↘️ Old location: {LocA} — decommission/make good; New location: {LocB} — confirm mounting clearances and access;"
  },
  Controls: {
    controls_reconfig:"↘️ Configure for {BlrB} operation; confirm room/cylinder controls as specified;"
  },
  HouseKeeping: {
    system_cleanse:"↘️ Cleanse system and dose inhibitor; fit system filter as specified;",
    trvs_balancing:"↘️ Fit/verify TRVs where required and balance system on completion;"
  }
};

// ---- Helper: derive flags
function flags(i){
  return {
    A_hasCylinder: i.CylA!=="NONE",
    A_isVented: ["VENTED_TANKED","FORTIC_COMBINED","PRIMATIC"].includes(i.CylA),
    A_isUnvented: i.CylA==="UNVENTED_MAINS",
    B_isCombi: i.BlrB==="COMBI",
    B_isSystem: i.BlrB==="SYSTEM",
    B_isRegular: i.BlrB==="REGULAR",
    B_needsCylinder: ["SYSTEM","REGULAR"].includes(i.BlrB) && i.CylB!=="NONE",
    Flu_change: i.FluA!==i.FluB,
    Chimney_to_RS: (["OPEN_FLUE","CHIMNEY"].includes(i.FluA) && ["H_BALANCED","V_BALANCED","PLUME_KIT"].includes(i.FluB)),
    Term_low: i.TermHeight==="LOW_LT_2M",
    Term_boundary: ["FRONT","ALLEY","NEAR_BOUNDARY","COURTYARD"].includes(i.TermWall),
    Loc_change: i.LocA!==i.LocB
  };
}

// ---- Rule engine: returns set of note keys per section
function resolve(i){
  const f = flags(i);
  const out = {
    SummaryChange: new Set(),
    SystemChanges: new Set(),
    HotWater: new Set(),
    Flue: new Set(),
    Gas: new Set(),
    Condensate: new Set(),
    LocationAndMakingGood: new Set(),
    Controls: new Set(),
    HouseKeeping: new Set()
  };

  // Summary
  const summary = (i.BlrA===i.BlrB && i.CylA===i.CylB)
    ? "↘️ Like for like;"
    : `↘️ Change from ${i.BlrA} to ${i.BlrB};`;
  out.SummaryChange.add(summary);

  // System changes
  if (f.B_isCombi && i.CylA!=="NONE"){ out.SystemChanges.add("remove_cylinder"); out.SystemChanges.add("space_gain"); }
  if (f.A_isVented && (f.B_isCombi || (f.B_isSystem && i.CylB!=="VENTED_TANKED"))){ out.SystemChanges.add("remove_FandE"); }
  if (f.B_needsCylinder && f.Loc_change){ out.SystemChanges.add("cylinder_relocation"); }

  // Hot water — ALWAYS populate based on proposed
  out.HotWater.add("cold_main_check");
  if (f.B_isCombi){
    out.HotWater.add("combi_performance");
  } else if (i.CylB==="UNVENTED_MAINS"){
    out.HotWater.add("unvented_requirements");
    out.HotWater.add("unvented_benefit");
  } else if (["VENTED_TANKED","FORTIC_COMBINED","PRIMATIC"].includes(i.CylB)){
    out.HotWater.add("vented_characteristics");
  } else if (i.CylB==="THERMAL_STORE"){
    out.HotWater.add("thermal_store_specifics");
  }

  // Flue
  if (f.Flu_change){ out.Flue.add("flue_clearances"); }
  // Balanced/plume/location specific
  if (["H_BALANCED","V_BALANCED","PLUME_KIT"].includes(i.FluB)) out.Flue.add("flue_clearances");
  if (i.FluB==="PLUME_KIT" || i.FluB==="H_BALANCED") out.Flue.add("plume_mitigation");
  if (f.Term_low) out.Flue.add("terminal_guard_required");
  if (f.Term_boundary) out.Flue.add("boundary_clearance_review");
  if (f.Chimney_to_RS) out.Flue.add("chimney_decommission");

  // Gas / Condensate (universal sanity)
  out.Gas.add("gas_supply_check");
  out.Condensate.add("condensate_route");

  // Locations / Controls / Housekeeping
  out.LocationAndMakingGood.add("loc_old_new");
  out.Controls.add("controls_reconfig");
  out.HouseKeeping.add("system_cleanse"); out.HouseKeeping.add("trvs_balancing");

  return out;
}

// ---- Render sections with copy buttons
function renderSections(buckets, inputs){
  const secEl = document.getElementById("sections");
  const order = ["SummaryChange","SystemChanges","HotWater","Flue","Gas","Condensate","LocationAndMakingGood","Controls","HouseKeeping"];
  const sectionTitles = {
    SummaryChange:"Summary Change",
    SystemChanges:"System Changes",
    HotWater:"Hot Water",
    Flue:"Flue",
    Gas:"Gas",
    Condensate:"Condensate",
    LocationAndMakingGood:"Location & Making Good",
    Controls:"Controls",
    HouseKeeping:"Housekeeping"
  };

  secEl.innerHTML = "";
  for(const key of order){
    const wrap = document.createElement("div"); wrap.className="section";
    const h = document.createElement("h3"); h.textContent = sectionTitles[key]; wrap.appendChild(h);
    const ta = document.createElement("textarea"); ta.id = "ta_"+key;
    const lines = [];
    for(const noteKey of buckets[key]){
      if (key==="SummaryChange" && noteKey.startsWith("↘️")) { lines.push(noteKey); }
      else {
        const src = NOTES[key][noteKey] || "";
        const line = src.replace("{LocA}", document.getElementById("LocA").value)
                        .replace("{LocB}", document.getElementById("LocB").value)
                        .replace("{BlrB}", document.getElementById("BlrB").value);
        if (line) lines.push(line);
      }
    }
    // Guarantee HotWater has at least one line (belt-and-braces)
    if (key==="HotWater" && lines.length===0){
      lines.push("↘️ Verify incoming cold main flow/pressure meets specification;");
    }
    ta.value = lines.join("\n");
    wrap.appendChild(ta);
    const btn = document.createElement("button"); btn.className="copy"; btn.textContent="Copy";
    btn.onclick = ()=>{ ta.select(); document.execCommand("copy"); };
    wrap.appendChild(btn);
    document.getElementById("sections").appendChild(wrap);
  }
}

// ---- Generate + Copy helpers
function read(id){ return document.getElementById(id).value; }
function generate(){
  const inputs = {
    BlrA:read("BlrA"), FluA:read("FluA"), CylA:read("CylA"), LocA:read("LocA"),
    BlrB:read("BlrB"), FluB:read("FluB"), CylB:read("CylB"), LocB:read("LocB"),
    TermWall:read("TermWall"), TermHeight:read("TermHeight")
  };
  const bucketSets = resolve(inputs);
  // Convert sets to arrays to preserve order as inserted
  const buckets = {};
  for(const k in bucketSets){ buckets[k] = Array.from(bucketSets[k]); }
  renderSections(buckets, inputs);
}
function copyAll(){
  const ids=["SummaryChange","SystemChanges","HotWater","Flue","Gas","Condensate","LocationAndMakingGood","Controls","HouseKeeping"]
    .map(k=>"ta_"+k);
  const all = ids.map(id=>document.getElementById(id)?.value||"").join("\n");
  const ta = document.createElement("textarea"); ta.style.position="fixed"; ta.style.left="-9999px"; ta.value = all;
  document.body.appendChild(ta); ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
  alert("All sections copied");
}
</script>
</body>
</html>
