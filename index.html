<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boiler Mapper</title>
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    body {
      background: #0b0d10;
      color: #e9eef5;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    h1 {
      margin: 0;
      font-size: clamp(1.8rem, 2.5vw, 2.6rem);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    fieldset {
      border: 1px solid #2a323c;
      padding: 14px;
      margin: 0;
      border-radius: 10px;
      min-width: 260px;
      flex: 1 1 280px;
      background: rgba(18, 23, 28, 0.6);
    }
    legend {
      padding: 0 6px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    select,
    button,
    textarea {
      margin: 5px 0 12px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #2a323c;
      background: #151a1f;
      color: #e9eef5;
      font-size: 0.95rem;
      width: 100%;
    }
    select:focus,
    button:focus,
    textarea:focus {
      outline: 2px solid #3d6cf3;
      outline-offset: 2px;
    }
    button {
      width: auto;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #1f2630;
      cursor: pointer;
    }
    button.copy {
      padding: 6px 12px;
      font-size: 0.75rem;
    }
    .grid {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .sections {
      display: grid;
      gap: 18px;
    }
    @media (min-width: 800px) {
      .sections {
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      }
    }
    .section {
      background: rgba(18, 23, 28, 0.6);
      border: 1px solid #2a323c;
      border-radius: 10px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 220px;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    .section-header h2 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin: 0;
    }
    textarea {
      resize: vertical;
      min-height: 140px;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    .section textarea {
      margin: 0;
    }
    .foot-actions {
      display: flex;
      justify-content: flex-end;
    }
  </style>
</head>
<body>
  <h1>Boiler Mapper</h1>
  <div class="grid">
    <fieldset>
      <legend>Current System (A)</legend>
      <label for="BlrA">Boiler Type
        <select id="BlrA">
          <option value="REGULAR">REGULAR</option>
          <option value="SYSTEM">SYSTEM</option>
          <option value="COMBI">COMBI</option>
          <option value="BBU">BBU</option>
          <option value="WARM_AIR">WARM_AIR</option>
          <option value="ELECTRIC_WET">ELECTRIC_WET</option>
        </select>
      </label>
      <label for="FluA">Flue Type
        <select id="FluA">
          <option value="HORIZONTAL">HORIZONTAL</option>
          <option value="VERTICAL">VERTICAL</option>
          <option value="PLUME_KIT">PLUME_KIT</option>
          <option value="CHIMNEY">CHIMNEY</option>
        </select>
      </label>
      <label for="CylA">Cylinder
        <select id="CylA">
          <option value="NONE">NONE</option>
          <option value="VENTED_TANKED">VENTED_TANKED</option>
          <option value="UNVENTED_MAINS">UNVENTED_MAINS</option>
          <option value="THERMAL_STORE">THERMAL_STORE</option>
          <option value="FORTIC_COMBINED">FORTIC_COMBINED</option>
          <option value="PRIMATIC">PRIMATIC</option>
        </select>
      </label>
      <label for="LocA">Location
        <select id="LocA">
          <option value="KITCHEN">KITCHEN</option>
          <option value="GARAGE">GARAGE</option>
          <option value="UTILITY">UTILITY</option>
          <option value="AIRING_CUPBOARD">AIRING_CUPBOARD</option>
          <option value="LOFT">LOFT</option>
        </select>
      </label>
    </fieldset>

    <fieldset>
      <legend>Proposed System (B)</legend>
      <label for="BlrB">Boiler Type
        <select id="BlrB">
          <option value="REGULAR">REGULAR</option>
          <option value="SYSTEM">SYSTEM</option>
          <option value="COMBI">COMBI</option>
          <option value="ELECTRIC_WET">ELECTRIC_WET</option>
        </select>
      </label>
      <label for="FluB">Flue Type
        <select id="FluB">
          <option value="HORIZONTAL">HORIZONTAL</option>
          <option value="VERTICAL">VERTICAL</option>
          <option value="PLUME_KIT">PLUME_KIT</option>
          <option value="CHIMNEY">CHIMNEY</option>
        </select>
      </label>
      <label for="CylB">Cylinder
        <select id="CylB">
          <option value="NONE">NONE</option>
          <option value="VENTED_TANKED">VENTED_TANKED</option>
          <option value="UNVENTED_MAINS">UNVENTED_MAINS</option>
          <option value="THERMAL_STORE">THERMAL_STORE</option>
        </select>
      </label>
      <label for="LocB">Location
        <select id="LocB">
          <option value="KITCHEN">KITCHEN</option>
          <option value="GARAGE">GARAGE</option>
          <option value="UTILITY">UTILITY</option>
          <option value="AIRING_CUPBOARD">AIRING_CUPBOARD</option>
          <option value="LOFT">LOFT</option>
        </select>
      </label>
    </fieldset>
  </div>

  <div class="actions">
    <button id="generate">Generate Notes</button>
  </div>

  <div class="sections" id="sections">
    <div class="section" data-section="SummaryChange">
      <div class="section-header">
        <h2>SummaryChange</h2>
        <button class="copy" data-copy="SummaryChange">Copy</button>
      </div>
      <textarea id="SummaryChange" rows="6" placeholder="↘️ Summary lines will appear here;"></textarea>
    </div>
    <div class="section" data-section="SystemChanges">
      <div class="section-header">
        <h2>SystemChanges</h2>
        <button class="copy" data-copy="SystemChanges">Copy</button>
      </div>
      <textarea id="SystemChanges" rows="6" placeholder="↘️ System change notes;"></textarea>
    </div>
    <div class="section" data-section="HotWater">
      <div class="section-header">
        <h2>HotWater</h2>
        <button class="copy" data-copy="HotWater">Copy</button>
      </div>
      <textarea id="HotWater" rows="6" placeholder="↘️ Hot water notes;"></textarea>
    </div>
    <div class="section" data-section="Flue">
      <div class="section-header">
        <h2>Flue</h2>
        <button class="copy" data-copy="Flue">Copy</button>
      </div>
      <textarea id="Flue" rows="4" placeholder="↘️ Flue notes;"></textarea>
    </div>
    <div class="section" data-section="Gas">
      <div class="section-header">
        <h2>Gas</h2>
        <button class="copy" data-copy="Gas">Copy</button>
      </div>
      <textarea id="Gas" rows="4" placeholder="↘️ Gas notes;"></textarea>
    </div>
    <div class="section" data-section="Condensate">
      <div class="section-header">
        <h2>Condensate</h2>
        <button class="copy" data-copy="Condensate">Copy</button>
      </div>
      <textarea id="Condensate" rows="4" placeholder="↘️ Condensate notes;"></textarea>
    </div>
    <div class="section" data-section="LocationAndMakingGood">
      <div class="section-header">
        <h2>LocationAndMakingGood</h2>
        <button class="copy" data-copy="LocationAndMakingGood">Copy</button>
      </div>
      <textarea id="LocationAndMakingGood" rows="6" placeholder="↘️ Location / making good notes;"></textarea>
    </div>
    <div class="section" data-section="Controls">
      <div class="section-header">
        <h2>Controls</h2>
        <button class="copy" data-copy="Controls">Copy</button>
      </div>
      <textarea id="Controls" rows="4" placeholder="↘️ Controls notes;"></textarea>
    </div>
    <div class="section" data-section="HouseKeeping">
      <div class="section-header">
        <h2>HouseKeeping</h2>
        <button class="copy" data-copy="HouseKeeping">Copy</button>
      </div>
      <textarea id="HouseKeeping" rows="4" placeholder="↘️ House keeping notes;"></textarea>
    </div>
  </div>

  <div class="foot-actions">
    <button id="copy-all">Copy All Sections</button>
  </div>

  <script>
    const logic = {
      notes: {
        remove_cylinder: "↘️ Remove existing hot-water cylinder and associated components;",
        space_gain: "↘️ Space reclaimed from cylinder/loft tanks — confirm preferred use;",
        remove_FandE: "↘️ Remove F&E tanks and convert to sealed system where applicable;",
        cold_main_check: "↘️ Verify incoming cold main flow/pressure meets combi/unvented requirements; upgrade if inadequate;",
        customer_expectations_combi: "↘️ Combi hot-water performance depends on mains flow; simultaneous draws reduce flow/temperature;",
        unvented_requirements: "↘️ Provide unvented G3 safety set, correctly sized discharge (D2) and termination; confirm main capacity;",
        customer_expectations_unvented: "↘️ Unvented cylinder provides mains-pressure hot water at multiple outlets (subject to main capacity);",
        cylinder_relocation: "↘️ New cylinder location — allow primary/secondary runs and compliant discharge path;",
        gas_supply_check: "↘️ Confirm gas pipe sizing and route for new input rating; upgrade if required;",
        condensate_route: "↘️ Confirm compliant condensate route and termination;",
        flue_clearances: "↘️ Check flue type/route/terminal clearances vs MI; confirm guards, plume management if needed;",
        system_cleanse: "↘️ Cleanse system and dose inhibitor; fit system filter as specified;",
        trvs_balancing: "↘️ Fit/verify TRVs where required and balance system on completion;"
      },
      rules: [
        { when: f => f.B_isCombi && f.A_hasCylinder, add: ["remove_cylinder", "space_gain"] },
        { when: f => f.B_isCombi, add: ["cold_main_check", "customer_expectations_combi"] },
        { when: f => f.B_isSystem && f.CylB === "UNVENTED_MAINS", add: ["unvented_requirements", "customer_expectations_unvented"] },
        { when: f => f.B_needsCylinder && f.Loc_change, add: ["cylinder_relocation"] },
        { when: f => f.A_isVented && (f.B_isCombi || (f.B_isSystem && f.CylB !== "VENTED_TANKED")), add: ["remove_FandE"] },
        { when: f => f.Flu_change, add: ["flue_clearances"] },
        { when: f => true, add: ["gas_supply_check", "condensate_route", "system_cleanse", "trvs_balancing"] }
      ]
    };

    const noteSections = {
      remove_cylinder: "HotWater",
      space_gain: "LocationAndMakingGood",
      remove_FandE: "SystemChanges",
      cold_main_check: "HotWater",
      customer_expectations_combi: "HotWater",
      unvented_requirements: "HotWater",
      customer_expectations_unvented: "HotWater",
      cylinder_relocation: "LocationAndMakingGood",
      gas_supply_check: "Gas",
      condensate_route: "Condensate",
      flue_clearances: "Flue",
      system_cleanse: "SystemChanges",
      trvs_balancing: "SystemChanges"
    };

    const sectionOrder = [
      "SummaryChange",
      "SystemChanges",
      "HotWater",
      "Flue",
      "Gas",
      "Condensate",
      "LocationAndMakingGood",
      "Controls",
      "HouseKeeping"
    ];

    function deriveFlags(i) {
      return {
        A_hasCylinder: i.CylA !== "NONE",
        A_isVented: ["VENTED_TANKED", "FORTIC_COMBINED", "PRIMATIC"].includes(i.CylA),
        B_isCombi: i.BlrB === "COMBI",
        B_isSystem: i.BlrB === "SYSTEM",
        B_needsCylinder: ["SYSTEM", "REGULAR"].includes(i.BlrB) && i.CylB !== "NONE",
        Flu_change: i.FluA !== i.FluB,
        Loc_change: i.LocA !== i.LocB
      };
    }

    function buildNoteKeys(input) {
      const flags = deriveFlags(input);
      const active = [];
      for (const rule of logic.rules) {
        if (rule.when(flags)) {
          active.push(...rule.add);
        }
      }
      return [...new Set(active)];
    }

    function formatLine(text) {
      return text.startsWith("↘️") ? text : `↘️ ${text.replace(/;?$/, ';')}`;
    }

    function generateSections(input) {
      const keys = buildNoteKeys(input);
      const sections = Object.fromEntries(sectionOrder.map(id => [id, []]));

      const title = input.BlrA === input.BlrB ? "Like for like" : `Change from ${input.BlrA} to ${input.BlrB}`;
      const summaryLines = [
        formatLine(`${title};`)
      ];
      const locationLine = input.LocA === input.LocB
        ? `↘️ Boiler location unchanged (${input.LocA});`
        : `↘️ Relocate boiler from ${input.LocA} to ${input.LocB};`;
      summaryLines.push(locationLine);
      const flueLine = input.FluA === input.FluB
        ? `↘️ Flue arrangement retained (${input.FluB});`
        : `↘️ Adapt flue from ${input.FluA} to ${input.FluB};`;
      summaryLines.push(flueLine);
      sections.SummaryChange.push(...summaryLines);

      for (const key of keys) {
        const section = noteSections[key] || "SystemChanges";
        sections[section].push(logic.notes[key]);
      }

      if (sections.Controls.length === 0) {
        sections.Controls.push("↘️ Confirm controls specification and zoning with client;");
      }
      if (sections.HouseKeeping.length === 0) {
        sections.HouseKeeping.push("↘️ Leave working area clean, remove waste and provide handover pack;");
      }

      if (sections.LocationAndMakingGood.length === 0) {
        sections.LocationAndMakingGood.push(locationLine);
      } else if (!sections.LocationAndMakingGood.includes(locationLine)) {
        sections.LocationAndMakingGood.unshift(locationLine);
      }

      return sections;
    }

    async function copyText(text) {
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          throw new Error('Clipboard API unavailable');
        }
      } catch (err) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      }
    }

    function populateSections(sections) {
      for (const id of sectionOrder) {
        const textarea = document.getElementById(id);
        if (!textarea) continue;
        textarea.value = sections[id].join('\n');
      }
    }

    function collectInput() {
      const get = id => document.getElementById(id).value;
      return {
        BlrA: get('BlrA'),
        FluA: get('FluA'),
        CylA: get('CylA'),
        LocA: get('LocA'),
        BlrB: get('BlrB'),
        FluB: get('FluB'),
        CylB: get('CylB'),
        LocB: get('LocB')
      };
    }

    document.getElementById('generate').addEventListener('click', () => {
      const input = collectInput();
      const sections = generateSections(input);
      populateSections(sections);
    });

    document.querySelectorAll('button.copy').forEach(btn => {
      btn.addEventListener('click', async event => {
        const id = event.currentTarget.dataset.copy;
        const textarea = document.getElementById(id);
        if (textarea) {
          await copyText(textarea.value);
          event.currentTarget.textContent = 'Copied!';
          setTimeout(() => {
            event.currentTarget.textContent = 'Copy';
          }, 1500);
        }
      });
    });

    document.getElementById('copy-all').addEventListener('click', async () => {
      const combined = sectionOrder
        .map(id => {
          const textarea = document.getElementById(id);
          return `${id}:\n${textarea ? textarea.value : ''}`;
        })
        .join('\n\n');
      await copyText(combined.trim());
      const button = document.getElementById('copy-all');
      button.textContent = 'Copied All!';
      setTimeout(() => {
        button.textContent = 'Copy All Sections';
      }, 1500);
    });

    populateSections(generateSections(collectInput()));
  </script>
</body>
</html>
